# -*- mode: makefile; -*-
# MMLLAR, available in the environment, is the list of articles in the MML
MMLLAR=$(shell head -n 10 $(MIZFILES)/mml.lar) tarski
DEP-MAKEFILES = $(patsubst %, %.dep, $(MMLLAR))
EVL-FILES = $(patsubst %, %.evl, $(MMLLAR))
MIZ = $(patsubst %, %.miz, $(MMLLAR))

# .PHONY is a bad bad thing, it remakes the target all over; don't use this
#.PHONY: deps
#.PHONY: $(patsubst %, %-dep, $(MMLLAR))

.SECONDARY: $(patsubst %, %.evl, $(MMLLAR))

deps: $(DEP-MAKEFILES)
evls: $(EVL-FILES)

%.evl: %.miz
	envget $*.miz; echo $$MIZFILES

%.dep: %.evl
	xsltproc ../xsl/evl2dep.xsl $*.evl | \
	perl -e '%h=(); $$_=<>; chop; m/(.*):(.*)/; ($$k,$$l)=($$1,$$2); @aa=split(/\ +/,$$l); @h{@aa} = (); print "$$k: "; print join(" ", keys %h); print "\n\ttouch mml/$*-dep"' > $*.dep
