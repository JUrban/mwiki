# -*- mode: makefile; -*-
MMLLAR=$(shell cat $(MIZFILES)/mml.lar) tarski
DEP-MAKEFILES = $(patsubst %, %.dep, $(MMLLAR))
EVL-FILES = $(patsubst %, %.evl, $(MMLLAR))
MIZ = $(patsubst %, %.miz, $(MMLLAR))

# .PHONY is a bad bad thing, it remakes the target all over; don't use this
#.PHONY: deps
#.PHONY: $(patsubst %, %-dep, $(MMLLAR))

ECHO=/bin/echo

dep-tag = "DEP   "
evl-tag = "EVL   "

.SECONDARY: $(patsubst %, %.evl, $(MMLLAR)) # don't auto-delete intermediate .dep files

deps: $(DEP-MAKEFILES)
evls: $(EVL-FILES)

%.evl: %.miz
	@$(ECHO) $(evl-tag) $*;
	@envget $*.miz > /dev/null 2> /dev/null;

%.dep: %.evl
	@$(ECHO) $(dep-tag) $*;
	@xsltproc ../xsl/evl2dep.xsl $*.evl | ../.perl/duplicates.pl > $*.dep;
