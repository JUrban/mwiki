# -*- mode: makefile; -*-
# MMLLAR, available in the environment, is the list of articles in the MML
MMLLAR=$(shell head -n 10000 $(MIZFILES)/mml.lar) tarski
DEP-MAKEFILES = $(patsubst %, %.dep, $(MMLLAR))
EVL-FILES = $(patsubst %, %.evl, $(MMLLAR))
MIZ = $(patsubst %, %.miz, $(MMLLAR))

# .PHONY is a bad bad thing, it remakes the target all over; don't use this
#.PHONY: deps
#.PHONY: $(patsubst %, %-dep, $(MMLLAR))

.SECONDARY: $(patsubst %, %.evl, $(MMLLAR)) # don't auto-delete intermediate .dep files

deps: $(DEP-MAKEFILES)
evls: $(EVL-FILES)

%.evl: %.miz
	envget $*.miz > /dev/null 2> /dev/null;

%.dep: %.evl
	xsltproc ../xsl/evl2dep.xsl $*.evl | duplicates.pl > $*.dep;
	echo "\ttouch $*-dep" >> $*.dep
